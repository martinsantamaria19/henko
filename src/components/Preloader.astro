---
import logo from "../assets/1-a.webp";
---

<div
    id="preloader"
    class="fixed inset-0 z-[9999] bg-gradient-to-br from-slate-50 via-white to-blue-50 flex items-center justify-center overflow-hidden"
>
    <!-- Animated Gradient Mesh Background -->
    <div class="absolute inset-0 opacity-30">
        <div class="gradient-blob blob-1"></div>
        <div class="gradient-blob blob-2"></div>
        <div class="gradient-blob blob-3"></div>
    </div>

    <!-- Geometric Particles -->
    <div id="particles" class="absolute inset-0 pointer-events-none z-0"></div>

    <!-- Logo Container -->
    <div class="relative z-10 flex flex-col items-center">
        <div class="logo-wrapper opacity-0 scale-90">
            <img src={logo.src} alt="Henko Loading" class="w-40 md:w-48" />
        </div>
        <!-- Loading Bar -->
        <div
            class="mt-8 md:mt-10 w-40 md:w-48 h-1 bg-gray-200 rounded-full overflow-hidden"
        >
            <div
                class="loading-bar w-0 h-full bg-gradient-to-r from-[#0B1C3E] to-[#6B9AC4] rounded-full"
            >
            </div>
        </div>
    </div>
</div>

<style>
    .gradient-blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(60px);
        opacity: 0.6;
    }

    .blob-1 {
        width: 400px;
        height: 400px;
        background: linear-gradient(135deg, #6b9ac4 0%, #0b1c3e 100%);
        top: -10%;
        left: -10%;
        animation: float 20s ease-in-out infinite;
    }

    .blob-2 {
        width: 350px;
        height: 350px;
        background: linear-gradient(135deg, #0b1c3e 0%, #6b9ac4 100%);
        bottom: -10%;
        right: -10%;
        animation: float 25s ease-in-out infinite reverse;
    }

    .blob-3 {
        width: 300px;
        height: 300px;
        background: linear-gradient(
            135deg,
            #6b9ac4 0%,
            rgba(11, 28, 62, 0.5) 100%
        );
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: pulse 15s ease-in-out infinite;
    }

    @keyframes float {
        0%,
        100% {
            transform: translate(0, 0) scale(1);
        }
        33% {
            transform: translate(30px, -30px) scale(1.1);
        }
        66% {
            transform: translate(-20px, 20px) scale(0.9);
        }
    }

    @keyframes pulse {
        0%,
        100% {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.6;
        }
        50% {
            transform: translate(-50%, -50%) scale(1.2);
            opacity: 0.8;
        }
    }
</style>

<script>
    import gsap from "gsap";

    document.addEventListener("DOMContentLoaded", () => {
        const tl = gsap.timeline({
            onComplete: () => {
                const preloader = document.getElementById("preloader");
                if (preloader) {
                    preloader.style.display = "none";
                }
                document.body.style.overflow = "auto";
                window.dispatchEvent(new CustomEvent("preloader-done"));
            },
        });

        // Lock scroll
        document.body.style.overflow = "hidden";

        // Create geometric particles
        const particlesContainer = document.getElementById("particles");
        const particleCount = 30;
        const shapes = ["circle", "square", "triangle"];

        if (particlesContainer) {
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement("div");
                const size = Math.random() * 8 + 4;
                const shape = shapes[Math.floor(Math.random() * shapes.length)];

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.position = "absolute";
                particle.style.opacity = "0";

                // Shape styling
                if (shape === "circle") {
                    particle.style.borderRadius = "50%";
                    particle.style.background =
                        "linear-gradient(135deg, #6B9AC4, #0B1C3E)";
                } else if (shape === "square") {
                    particle.style.borderRadius = "2px";
                    particle.style.background = "#0B1C3E";
                    particle.style.transform = "rotate(45deg)";
                } else {
                    // Triangle using border trick
                    particle.style.width = "0";
                    particle.style.height = "0";
                    particle.style.borderLeft = `${size / 2}px solid transparent`;
                    particle.style.borderRight = `${size / 2}px solid transparent`;
                    particle.style.borderBottom = `${size}px solid #6B9AC4`;
                }

                particlesContainer.appendChild(particle);

                // Floating animation
                gsap.fromTo(
                    particle,
                    {
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        opacity: 0,
                        scale: 0,
                    },
                    {
                        y: `+=${(Math.random() - 0.5) * 200}`,
                        x: `+=${(Math.random() - 0.5) * 200}`,
                        opacity: Math.random() * 0.4 + 0.1,
                        scale: Math.random() * 1.5 + 0.5,
                        duration: 2 + Math.random() * 2,
                        ease: "sine.inOut",
                        delay: Math.random() * 0.5,
                        yoyo: true,
                        repeat: -1,
                    },
                );
            }
        }

        // ANIMATION SEQUENCE

        // 1. Logo Reveal
        tl.to(
            ".logo-wrapper",
            {
                opacity: 1,
                scale: 1,
                duration: 0.8,
                ease: "back.out(1.7)",
            },
            0,
        );

        // 2. Loading Bar
        tl.to(
            ".loading-bar",
            {
                width: "100%",
                duration: 2.5,
                ease: "power2.inOut",
            },
            0.2,
        );

        // 3. Subtle Logo Breathe
        tl.to(
            ".logo-wrapper",
            {
                scale: 1.05,
                duration: 0.8,
                yoyo: true,
                repeat: 2,
                ease: "sine.inOut",
            },
            0.5,
        );

        // 4. EXIT
        tl.to(".logo-wrapper", {
            scale: 0.9,
            opacity: 0,
            duration: 0.4,
            ease: "power2.in",
        }).to(
            "#preloader",
            {
                yPercent: -100,
                duration: 0.7,
                ease: "power4.inOut",
            },
            "-=0.2",
        );
    });
</script>
