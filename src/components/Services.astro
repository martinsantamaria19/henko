---
import analyticsAndReporting from "../assets/analytics-and-reporting.webp";
import brandBuilding from "../assets/brand-building.webp";
import consulting from "../assets/consulting.webp";
import creativityAndBrandStrategy from "../assets/creativity-and-brand-strategy.webp";
import decorativeCircle from "../assets/decorative-circle.webp";
import digitalGrowth from "../assets/digital-growth.webp";
import performanceMarketing from "../assets/performance-marketing.webp";
import socialMediaContent from "../assets/social-media-content.webp";
import strategicPlanning from "../assets/strategic-planning.webp";

const services = [
    {
        icon: performanceMarketing,
        title: "Publicidad Online y Performance Marketing",
        description: "Gestionamos campañas de Google Ads, Facebook, Instagram y WhatsApp con foco en ventas, clientes potenciales y retorno de inversión."
    },
    {
        icon: socialMediaContent,
        title: "Gestión de redes sociales",
        description: "Diseñamos, publicamos y analizamos contenido estratégico para potenciar tu presencia digital y generar engagement real."
    },
    {
        icon: strategicPlanning,
        title: "Estrategia digital",
        description: "Diseñamos planes de marketing digital adaptados a cada empresa para lograr que crezcan en su sector."
    },
    {
        icon: analyticsAndReporting,
        title: "Analytics & Reporting",
        description: "Analizamos el rendimiento de tus campañas y redes sociales con métricas claras para optimizar cada acción."
    },
    {
        icon: creativityAndBrandStrategy,
        title: "Diseño y producción audiovisual",
        description: "Creamos piezas gráficas y contenidos audiovisuales (videos, animaciones, spots) para potenciar la comunicación digital de tu marca."
    },
    {
        icon: brandBuilding,
        title: "Branding y construcción de marca",
        description: "Construimos marcas sólidas con identidad y storytelling para conectar con las audiencias correctas"
    },
    {
        icon: consulting,
        title: "Consultorías",
        description: "Te asesoramos en estrategias digitales personalizadas para que tu negocio crezca con decisiones claras y medibles."
    },
    {
        icon: digitalGrowth,
        title: "Capacitaciones",
        description: "Entrenamos a equipos en herramientas, redes y performance para que puedan liderar su propia transformación digital."
    }
];
---

<section class="pt-0 md:pt-24 pb-24 md:pb-32 relative overflow-hidden" id="servicios">
    <!-- Semicírculo y patrón solo en desktop amplio para no recargar mobile/tablet -->
    <div class="hidden lg:block absolute inset-0 pointer-events-none">
        <!-- Patrón de puntos a la izquierda -->
        <div
            class="absolute inset-0 w-full h-[60vh] z-10"
            style="background-image: radial-gradient(#CBD5E1 3px, transparent 2px); background-size: 30px 30px; opacity: 0.85;"
        >
        </div>

        <!-- Semicírculo suave a la derecha -->
        <div
            class="absolute -top-[-10%] right-[-20%] w-[70%] h-[60%] bg-gradient-to-b from-[#d2e0e9] to-[#d2e0e9] rounded-l-[999px] z-0"
        >
        </div>
    </div>

    <div class="container mx-auto px-6 md:px-8 relative z-10">
        <!-- Header -->
        <div class="mb-10 md:mb-16 text-center md:text-left">
            <h2 class="text-3xl md:text-5xl font-extrabold text-slate-900 mb-4 md:mb-6">
                ¿Qué hacemos?
            </h2>
            <a
                href="#contact"
                class="inline-flex items-center gap-3 bg-[#0F172A] text-white px-7 py-3 rounded-full text-sm font-semibold hover:bg-opacity-95 transition-colors shadow-lg"
            >
                Quiero saber más en una reunión
                <span
                    class="w-7 h-7 rounded-full bg-white/10 flex items-center justify-center text-lg"
                    >→</span
                >
            </a>
        </div>

        <!-- Grid de servicios: en mobile solo 3 visibles + "Ver más" -->
        <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-10 lg:gap-0 w-full"
            id="servicios-grid"
        >
            {services.slice(0, 3).map((service) => (
                <div
                    class="service-card relative group bg-white rounded-3xl w-full max-w-[280px] mx-auto pt-5 pb-3 px-5 shadow-[0_18px_40px_rgba(15,23,42,0.08)] transition-all duration-500 ease-out flex flex-col opacity-0 translate-x-10 cursor-pointer mt-10"
                    style="transform-style: preserve-3d; perspective: 1000px; min-height: 240px; max-height: 260px;"
                >
                    <div
                        class="absolute -top-6 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-white shadow-[0_10px_25px_rgba(15,23,42,0.12)] flex items-center justify-center border border-slate-100 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-2"
                        style="transform: translateZ(20px);"
                    >
                        <img src={service.icon.src} alt={service.title} class="w-7 h-7 object-contain" />
                    </div>
                    <div class="flex flex-col flex-1 justify-start items-center mt-3 pt-3 pb-2">
                        <h3 class="mb-1 text-base font-bold text-slate-900 text-center transition-colors duration-500 ease-out group-hover:text-white px-1" style="transform: translateZ(10px);">{service.title}</h3>
                        <p class="text-xs text-gray-500 text-center leading-snug mb-2 transition-colors duration-500 ease-out group-hover:text-white px-1" style="transform: translateZ(10px);">{service.description}</p>
                    </div>
                    <div class="flex justify-center mt-0" style="transform: translateZ(20px);">
                        <div class="w-7 h-7 rounded-full bg-[#699FBF] text-white flex items-center justify-center text-xs transform transition-all duration-300 group-hover:scale-110">→</div>
                    </div>
                </div>
            ))}
            {services.slice(3).map((service, index) => (
                <div
                    class={`service-card services-extra relative group bg-white rounded-3xl w-full max-w-[280px] mx-auto pt-5 pb-3 px-5 shadow-[0_18px_40px_rgba(15,23,42,0.08)] transition-all duration-500 ease-out flex flex-col opacity-0 translate-x-10 cursor-pointer hidden md:!block ${index === 0 ? 'mt-10' : 'mt-10 lg:mt-[90px]'}`}
                    style="transform-style: preserve-3d; perspective: 1000px; min-height: 240px; max-height: 260px;"
                >
                    <div
                        class="absolute -top-6 left-1/2 -translate-x-1/2 w-12 h-12 rounded-full bg-white shadow-[0_10px_25px_rgba(15,23,42,0.12)] flex items-center justify-center border border-slate-100 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-2"
                        style="transform: translateZ(20px);"
                    >
                        <img src={service.icon.src} alt={service.title} class="w-7 h-7 object-contain" />
                    </div>
                    <div class="flex flex-col flex-1 justify-start items-center mt-3 pt-3 pb-2">
                        <h3 class="mb-1 text-base font-bold text-slate-900 text-center transition-colors duration-500 ease-out group-hover:text-white px-1" style="transform: translateZ(10px);">{service.title}</h3>
                        <p class="text-xs text-gray-500 text-center leading-snug mb-2 transition-colors duration-500 ease-out group-hover:text-white px-1" style="transform: translateZ(10px);">{service.description}</p>
                    </div>
                    <div class="flex justify-center mt-0" style="transform: translateZ(20px);">
                        <div class="w-7 h-7 rounded-full bg-[#699FBF] text-white flex items-center justify-center text-xs transform transition-all duration-300 group-hover:scale-110">→</div>
                    </div>
                </div>
            ))}
        </div>
        <div class="flex justify-center md:hidden mt-8" id="servicios-ver-mas-wrap">
            <button type="button" id="servicios-ver-mas-btn" class="text-[#0F172A] font-semibold text-sm py-3 px-6 rounded-full border-2 border-[#0F172A] hover:bg-[#0F172A] hover:text-white transition-colors" aria-expanded="false">Ver más</button>
        </div>
    </div>
</section>

<script>
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener("DOMContentLoaded", () => {
        const verMasBtn = document.getElementById("servicios-ver-mas-btn");
        const extraCards = document.querySelectorAll(".services-extra");
        function updateVerMasState(expanded: boolean) {
            if (!verMasBtn) return;
            verMasBtn.setAttribute("aria-expanded", String(expanded));
            verMasBtn.textContent = expanded ? "Ver menos" : "Ver más";
            extraCards.forEach((card) => {
                (card as HTMLElement).classList.toggle("hidden", !expanded);
            });
        }
        verMasBtn?.addEventListener("click", () => {
            const expanded = verMasBtn.getAttribute("aria-expanded") === "true";
            updateVerMasState(!expanded);
        });
        window.addEventListener("resize", () => {
            if (!window.matchMedia("(max-width: 767px)").matches) updateVerMasState(false);
        });
        // 1. Entrance Animation (Stagger)
        gsap.to(".service-card", {
            scrollTrigger: {
                trigger: "#servicios",
                start: "top 80%", // Start when top of section hits 80% of viewport
            },
            x: 0,
            opacity: 1,
            duration: 0.8,
            stagger: 0.1,
            ease: "power3.out",
        });

        // 2. 3D Tilt Effect
        const cards = document.querySelectorAll(".service-card");

        cards.forEach((card) => {
            card.addEventListener("mousemove", (e) => {
                const mouseEvent = e as MouseEvent;
                // Cast to HTMLElement to access offset properties
                const el = card as HTMLElement;
                const rect = el.getBoundingClientRect();
                const x = mouseEvent.clientX - rect.left;
                const y = mouseEvent.clientY - rect.top;

                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const rotateX = ((y - centerY) / centerY) * -10; // Max rotation deg
                const rotateY = ((x - centerX) / centerX) * 10;

                gsap.to(el, {
                    rotationX: rotateX,
                    rotationY: rotateY,
                    backgroundColor: "#083763",
                    scale: 1.05,
                    boxShadow: "0 24px 60px rgba(15,23,42,0.25)",
                    duration: 0.5,
                    ease: "power2.out",
                });
            });

            card.addEventListener("mouseleave", () => {
                gsap.to(card, {
                    rotationX: 0,
                    rotationY: 0,
                    scale: 1,
                    backgroundColor: "#ffffff",
                    boxShadow: "0 18px 40px rgba(15,23,42,0.08)",
                    duration: 0.6,
                    ease: "power2.out",
                });
            });
        });
    });
</script>