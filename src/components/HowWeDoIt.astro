---
// Importar todas las imágenes - Solo necesitas subir estos archivos a src/assets/
import meetingImage from "../assets/meeting.webp";
import planningImage from "../assets/planning.webp";
import estrategiaImage from "../assets/estrategia.webp";
import campanasImage from "../assets/campanas.webp";
import desarrolloImage from "../assets/desarrollo.webp";
import entregaImage from "../assets/entrega.webp";

// Colores de los brillos en las 4 esquinas (formato HEX)
// Podés modificar cada uno de forma independiente (ej: "#60A5FA").
const CORNER_GLOW_LEFT_TOP_HEX = "#00213a";
const CORNER_GLOW_RIGHT_TOP_HEX = "#00213a";
const CORNER_GLOW_LEFT_BOTTOM_HEX = "#00213a";
const CORNER_GLOW_RIGHT_BOTTOM_HEX = "#00213a";

// Utilidad para convertir HEX a "r, g, b"
function hexToRgb(hex: string): string {
    let cleaned = hex.replace("#", "");
    if (cleaned.length === 3) {
        cleaned =
            cleaned[0] +
            cleaned[0] +
            cleaned[1] +
            cleaned[1] +
            cleaned[2] +
            cleaned[2];
    }
    const r = parseInt(cleaned.substring(0, 2), 16);
    const g = parseInt(cleaned.substring(2, 4), 16);
    const b = parseInt(cleaned.substring(4, 6), 16);
    return `${r}, ${g}, ${b}`;
}

// RGB derivados de los HEX (no tocar salvo que quieras sobreescribir manualmente)
const CORNER_GLOW_LEFT_TOP_RGB = hexToRgb(CORNER_GLOW_LEFT_TOP_HEX);
const CORNER_GLOW_RIGHT_TOP_RGB = hexToRgb(CORNER_GLOW_RIGHT_TOP_HEX);
const CORNER_GLOW_LEFT_BOTTOM_RGB = hexToRgb(CORNER_GLOW_LEFT_BOTTOM_HEX);
const CORNER_GLOW_RIGHT_BOTTOM_RGB = hexToRgb(CORNER_GLOW_RIGHT_BOTTOM_HEX);
---

<div
    class="relative bg-primary-dark text-white overflow-hidden flex flex-col min-h-[80vh] group max-w-19/20 mx-auto rounded-[3vw]"
    style={`background:
        radial-gradient(circle at top left, rgba(${CORNER_GLOW_LEFT_TOP_RGB},0.10) 0%, rgba(${CORNER_GLOW_LEFT_TOP_RGB},0) 40%),
        radial-gradient(circle at top right, rgba(${CORNER_GLOW_RIGHT_TOP_RGB},0.10) 0%, rgba(${CORNER_GLOW_RIGHT_TOP_RGB},0) 40%),
        radial-gradient(circle at bottom left, rgba(${CORNER_GLOW_LEFT_BOTTOM_RGB},0.10) 0%, rgba(${CORNER_GLOW_LEFT_BOTTOM_RGB},0) 40%),
        radial-gradient(circle at bottom right, rgba(${CORNER_GLOW_RIGHT_BOTTOM_RGB},0.10) 0%, rgba(${CORNER_GLOW_RIGHT_BOTTOM_RGB},0) 40%),
        #0B1B32;`}
>
    <button
        id="prevArrow"
        class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 z-30 w-10 h-10 md:w-12 md:h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center transition-all duration-300 backdrop-blur-sm border border-white/20 hover:scale-110 active:scale-95 cursor-pointer opacity-50 md:opacity-0 group-hover:opacity-100"
        aria-label="Slide anterior"
    >
        <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"></path>
        </svg>
    </button>

    <button
        id="nextArrow"
        class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 z-30 w-10 h-10 md:w-12 md:h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center transition-all duration-300 backdrop-blur-sm border border-white/20 hover:scale-110 active:scale-95 cursor-pointer opacity-50 md:opacity-0 group-hover:opacity-100"
        aria-label="Slide siguiente"
    >
        <svg
            class="w-5 h-5 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"></path>
        </svg>
    </button>

    <!-- Forma decorativa azul de fondo -->
    <div class="absolute right-0 top-0 w-[800px] h-[600px] -z-0 opacity-20">
        <svg
            viewBox="0 0 800 600"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="w-full h-full"
        >
            <path
                d="M800 0C800 0 650 100 550 200C450 300 400 400 300 450C200 500 100 550 0 600V0H800Z"
                fill="url(#blueGradient)"
                opacity="0.3"></path>
            <defs>
                <linearGradient
                    id="blueGradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="100%"
                >
                    <stop
                        offset="0%"
                        style="stop-color:#3B82F6;stop-opacity:0.4"></stop>
                    <stop
                        offset="100%"
                        style="stop-color:#1E40AF;stop-opacity:0.2"></stop>
                </linearGradient>
            </defs>
        </svg>
    </div>

    <div
        class="container mx-auto px-8 md:px-16 relative z-10 h-full flex flex-col py-16 md:py-20"
        style="min-height: 80vh;"
    >
        <div
            class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 flex-grow items-center"
        >
            <!-- Columna Izquierda -->
            <div class="flex flex-col justify-between h-full">
                <!-- Sección superior: Título y descripción -->
                <div class="flex-shrink-0">
                    <h2
                        class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6"
                    >
                        ¿Cómo lo hacemos?
                    </h2>
                    <p
                        class="text-gray-400 text-base md:text-lg leading-relaxed max-w-lg"
                    >
                        Nuestro proceso combina estrategia, creatividad y medición constante para transformar tu comunicación y generar resultados reales.
                    </p>
                </div>

                <!-- Espaciador flexible -->
                <div class="flex-grow"></div>

                <!-- Sección inferior: Contenido del slide + indicadores -->
                <div class="flex-shrink-0 flex flex-col gap-16">
                    <!-- Contenedor de slides con altura mínima -->
                    <div class="relative min-h-[180px]">
                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="0"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Reunión inicial
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Escuchamos tus objetivos y analizamos la situación actual de tu marca en el mercado.
                            </p>
                        </div>

                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="1"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Diagnóstico y planificación
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Identificamos oportunidades, definimos metas y trazamos un plan estratégico de marketing digital.
                            </p>
                        </div>

                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="2"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Estrategia y creatividad
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Diseñamos campañas y contenidos adaptados a tu rubro, siempre alineados a tu propósito.
                            </p>
                        </div>

                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="3"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Ejecución de campañas
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Implementamos publicidad digital, gestión de redes sociales y acciones de comunicación.
                            </p>
                        </div>

                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="4"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Medición y optimización
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Monitoreamos resultados en tiempo real, ajustando tácticas para maximizar el rendimiento.
                            </p>
                        </div>

                        <div
                            class="slide-text absolute inset-0 transition-opacity duration-500 ease-in-out opacity-0"
                            data-slide="5"
                        >
                            <h3
                                class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4"
                                style="font-style: italic;"
                            >
                                Entrega de resultados
                            </h3>
                            <p
                                class="text-gray-300 text-base md:text-lg leading-relaxed max-w-md"
                            >
                                Te mostramos métricas claras y aprendizajes que garantizan la evolución continua de tu marca.
                            </p>
                        </div>
                    </div>

                    <!-- Indicadores separados con gap -->
                    <div class="flex gap-2" id="sliderIndicators">
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="0"
                            aria-label="Slide 1"
                            style="width: 32px;"></button>
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="1"
                            aria-label="Slide 2"
                            style="width: 32px;"></button>
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="2"
                            aria-label="Slide 3"
                            style="width: 32px;"></button>
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="3"
                            aria-label="Slide 4"
                            style="width: 32px;"></button>
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="4"
                            aria-label="Slide 5"
                            style="width: 32px;"></button>
                        <button
                            class="indicator h-3 bg-gray-500 rounded-full transition-all duration-300 hover:bg-opacity-80 cursor-pointer"
                            data-index="5"
                            aria-label="Slide 6"
                            style="width: 32px;"></button>
                    </div>
                </div>
            </div>

            <!-- Columna Derecha - Imagen centrada verticalmente -->
            <div
                class="relative flex items-center justify-center min-h-[400px] lg:h-full"
            >
                <div
                    class="absolute w-[450px] h-[450px] bg-white/5 rounded-full blur-3xl -z-10"
                >
                </div>

                <div
                    class="relative w-[350px] h-[350px] md:w-[400px] md:h-[400px] flex items-center justify-center"
                >
                    <div
                        id="illustration-0"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={meetingImage.src}
                            alt="Meeting"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                    <div
                        id="illustration-1"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={planningImage.src}
                            alt="Planning"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                    <div
                        id="illustration-2"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={estrategiaImage.src}
                            alt="Estrategia"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                    <div
                        id="illustration-3"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={campanasImage.src}
                            alt="Campañas"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                    <div
                        id="illustration-4"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={desarrolloImage.src}
                            alt="Desarrollo"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                    <div
                        id="illustration-5"
                        class="absolute inset-0 flex items-center justify-center opacity-0 transition-all duration-500"
                    >
                        <img
                            src={entregaImage.src}
                            alt="Entrega"
                            class="max-w-[300px] max-h-[300px] w-auto h-auto object-contain drop-shadow-xl"
                        />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener("DOMContentLoaded", () => {
        const slides = document.querySelectorAll(".slide-text");
        const indicators = document.querySelectorAll(".indicator");
        const totalSlides = slides.length;
        let currentSlide = 0;
        let isAnimating = false;
        let autoSlideInterval;

        // Initialize first slide
        gsap.set(slides[0], { opacity: 1, y: 0, zIndex: 10 });
        gsap.set(".indicator[data-index='0']", {
            width: "48px",
            backgroundColor: "#ffffff",
        });
        gsap.set("#illustration-0", { opacity: 1, scale: 1 });

        function goToSlide(index) {
            if (isAnimating || index === currentSlide) return;
            isAnimating = true;

            const prevSlide = currentSlide;
            currentSlide = index;

            // 1. Text Transition
            const tl = gsap.timeline({
                onComplete: () => {
                    isAnimating = false;
                },
            });

            tl.to(slides[prevSlide], {
                opacity: 0,
                y: -20,
                duration: 0.5,
                ease: "power2.in",
            })
                .set(slides[prevSlide], { zIndex: 0 })
                .set(slides[currentSlide], { zIndex: 10, y: 20 })
                .to(
                    slides[currentSlide],
                    {
                        opacity: 1,
                        y: 0,
                        duration: 0.5,
                        ease: "power2.out",
                    },
                    "-=0.1",
                );

            // 2. Image Transition
            gsap.to(`#illustration-${prevSlide}`, {
                opacity: 0,
                scale: 0.9,
                duration: 0.5,
                ease: "power2.inOut",
            });

            gsap.to(`#illustration-${currentSlide}`, {
                opacity: 1,
                scale: 1,
                duration: 0.5,
                ease: "power2.inOut",
            });

            // 3. Indicators
            gsap.to(indicators, {
                width: "32px",
                backgroundColor: "#6B7280", // gray-500
                duration: 0.3,
            });

            gsap.to(indicators[currentSlide], {
                width: "48px",
                backgroundColor: "#ffffff",
                duration: 0.3,
            });
        }

        function nextSlide() {
            goToSlide((currentSlide + 1) % totalSlides);
        }

        function prevSlide() {
            goToSlide((currentSlide - 1 + totalSlides) % totalSlides);
        }

        function startAutoSlide() {
            if (autoSlideInterval) clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(nextSlide, 5000);
        }

        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }

        // Event Listeners
        document.getElementById("nextArrow")?.addEventListener("click", () => {
            nextSlide();
            stopAutoSlide();
            startAutoSlide();
        });

        document.getElementById("prevArrow")?.addEventListener("click", () => {
            prevSlide();
            stopAutoSlide();
            startAutoSlide();
        });

        indicators.forEach((indicator, i) => {
            indicator.addEventListener("click", () => {
                goToSlide(i);
                stopAutoSlide();
                startAutoSlide();
            });
        });

        // Hover Pause
        const container = document.querySelector(".group");
        container?.addEventListener("mouseenter", stopAutoSlide);
        container?.addEventListener("mouseleave", startAutoSlide);

        // Magnetic Buttons
        const buttons = document.querySelectorAll("#prevArrow, #nextArrow");
        buttons.forEach((btn) => {
            btn.addEventListener("mousemove", (e) => {
                const mouseEvent = e as MouseEvent;
                const rect = (btn as HTMLElement).getBoundingClientRect();
                const x = mouseEvent.clientX - rect.left - rect.width / 2;
                const y = mouseEvent.clientY - rect.top - rect.height / 2;

                gsap.to(btn, {
                    x: x * 0.3,
                    y: y * 0.3,
                    duration: 0.3,
                    ease: "power2.out",
                });
            });

            btn.addEventListener("mouseleave", () => {
                gsap.to(btn, {
                    x: 0,
                    y: 0,
                    duration: 0.5,
                    ease: "elastic.out(1, 0.3)",
                });
            });
        });

        // Start
        startAutoSlide();
    });
</script>

<style>
    .slide-text {
        will-change: opacity, transform;
        /* Añade un pequeño movimiento al aparecer */
        transform: translateY(1rem);
    }
    .slide-text.opacity-100 {
        transform: translateY(0);
    }

    .indicator {
        will-change: width, background-color;
        outline: none;
    }

    [id^="illustration-"] {
        will-change: transform, opacity;
        transition:
            transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
            opacity 0.5s ease-in-out;
    }
</style>
