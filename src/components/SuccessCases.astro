---
import arquiBrokersRounded from "../assets/arqui-brokers-rounded.webp";
import castellsInmueblesRound from "../assets/castells-inmuebles-round.webp";
import equipamientoGastronomicoSantucciRound from "../assets/equipamiento-gastronomico-santucci-round.webp";

const cases = [
    {
        id: 1,
        name: "ARQUIBROKERS",
        challenge: "Captar clientes en un mercado competitivo.",
        strategy: "Performance marketing en Google y redes sociales.",
        results: "+120% leads calificados en 6 meses.",
        circleColor: "#00205B",
        gradient: null,
        image: arquiBrokersRounded,
    },
    {
        id: 2,
        name: "CASTELLS INMUEBLES",
        challenge: "Potenciar la visibilidad y el retorno de inversión.",
        strategy: "Optimización de presencia digital y pauta.",
        results: "Duplicamos su presencia y mejoramos el ROI un 80%.",
        circleColor: null,
        gradient: "linear-gradient(180deg, #2B5C96 0%, #183052 100%)",
        image: castellsInmueblesRound,
    },
    {
        id: 3,
        name: "SANTUCCI",
        challenge: "Impulsar el crecimiento de la comunidad y ventas.",
        strategy: "Campañas creativas de contenido y ads.",
        results: "Aumento significativo de comunidad y ventas online.",
        circleColor: "#EF5533",
        gradient: null,
        image: equipamientoGastronomicoSantucciRound,
    },
];
---

<section class="py-24 relative overflow-hidden" id="casos">
    <div
        class="absolute inset-0 opacity-[0.3] z-0 pointer-events-none"
        style="background-image: radial-gradient(#94A3B8 1.5px, transparent 1.5px); background-size: 32px 32px;"
    >
    </div>

    <div class="container mx-auto px-4 md:px-8 relative z-10">
        <div class="mb-20 pl-4 md:pl-0">
            <h2
                class="text-4xl md:text-5xl font-extrabold text-[#0F172A] tracking-tight mb-4 max-w-4xl"
            >
                Casos de éxito: campañas digitales que generan resultados en
                Uruguay
            </h2>
        </div>

        <div class="relative pt-10 overflow-hidden group">
            <div
                id="infiniteCarousel"
                class="flex gap-8 overflow-x-hidden pb-16 no-scrollbar px-4 cursor-grab active:cursor-grabbing"
            >
                {
                    cases.map((item) => (
                        <div class="carousel-item flex-none flex flex-col">
                            <div class="relative w-[320px] md:w-[400px] mt-24 hover:-translate-y-2 transition-transform duration-300 flex-1 flex flex-col">
                                <div
                                    class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 rounded-full flex items-center justify-center text-white font-bold text-xl shadow-xl z-20 overflow-hidden bg-white"
                                    style={
                                        !item.image
                                            ? `background:${item.gradient ?? item.circleColor ?? "#0B3B91"};`
                                            : ""
                                    }
                                >
                                    {(item as any).image ? (
                                        <img
                                            src={(item as any).image.src}
                                            alt={item.name}
                                            class="w-full h-full object-cover"
                                        />
                                    ) : (
                                        <span class="px-4 text-center">
                                            {(item as any).name}
                                        </span>
                                    )}
                                </div>

                                <div class="bg-white rounded-[35px] shadow-[0_8px_30px_rgb(0,0,0,0.04)] p-8 pt-28 pb-8 text-center border border-slate-50 flex-1 flex flex-col relative z-10">
                                    <h3 class="text-2xl font-extrabold text-[#0F172A] uppercase tracking-wide mb-8">
                                        {item.name}
                                    </h3>

                                    <div class="space-y-6 flex-grow text-left px-2">
                                        <div>
                                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">
                                                Desafío
                                            </h4>
                                            <p class="text-slate-700 text-sm font-medium leading-relaxed">
                                                {item.challenge}
                                            </p>
                                        </div>
                                        <div>
                                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">
                                                Estrategia
                                            </h4>
                                            <p class="text-slate-700 text-sm font-medium leading-relaxed">
                                                {item.strategy}
                                            </p>
                                        </div>
                                        <div>
                                            <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">
                                                Resultados
                                            </h4>
                                            <p class="text-emerald-600 text-sm font-bold leading-relaxed">
                                                {item.results}
                                            </p>
                                        </div>
                                    </div>

                                    <div class="mt-8 flex justify-center w-full">
                                        <a
                                            href="#"
                                            class="inline-flex items-center gap-2 text-[#0F172A] font-bold hover:text-primary-light transition-colors"
                                        >
                                            Quiero estos resultados
                                            <svg
                                                width="20"
                                                height="20"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M5 12H19M19 12L12 5M19 12L12 19"
                                                    stroke="currentColor"
                                                    stroke-width="2"
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                />
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
</section>

<script>
    function initInfiniteCarousel() {
        const carouselEl = document.getElementById(
            "infiniteCarousel",
        ) as HTMLElement | null;
        if (!carouselEl) return;
        const carousel = carouselEl as HTMLElement;

        // Configuración
        const SPEED = 0.5; // Velocidad del autoscroll (píxeles por frame)
        let scrollAmount = 0;
        let isHovered = false;
        let animationId;

        // 1. Duplicar contenido para efecto infinito
        // Clonamos los elementos suficientes para llenar la pantalla al menos dos veces
        const items = Array.from(
            carousel ? carousel.children : [],
        ) as HTMLElement[];
        const containerWidth = carousel.offsetWidth;
        const totalContentWidth = carousel.scrollWidth;

        // Si el contenido es poco, clonamos varias veces para asegurar el scroll suave
        items.forEach((item) => {
            const clone = (item as HTMLElement).cloneNode(true) as HTMLElement;
            clone.setAttribute("aria-hidden", "true"); // Accesibilidad: ocultar duplicados
            carousel.appendChild(clone);
        });

        // Si aún es muy corto, clonamos otra vez (seguridad para pantallas muy anchas)
        if (totalContentWidth < containerWidth * 2) {
            items.forEach((item) => {
                const clone = (item as HTMLElement).cloneNode(
                    true,
                ) as HTMLElement;
                clone.setAttribute("aria-hidden", "true");
                carousel.appendChild(clone);
            });
        }

        // 2. Lógica de animación
        function step() {
            if (!isHovered) {
                scrollAmount += SPEED;

                // El punto de reinicio es la mitad del contenido duplicado
                // Cuando hemos scrolleado la longitud del set original de items, reseteamos a 0
                // Nota: scrollWidth / 2 asume que duplicamos el contenido exactamente una vez (o pares)
                // Para ser más precisos, medimos el primer item original hasta el último original.
                const firstSetWidth = items.reduce(
                    (acc, item) => acc + (item as HTMLElement).offsetWidth + 32,
                    0,
                ); // 32 es el gap (gap-8 = 2rem = 32px)

                if (scrollAmount >= firstSetWidth) {
                    scrollAmount = 0;
                }

                carousel.scrollLeft = scrollAmount;
            }
            animationId = requestAnimationFrame(step);
        }

        // Iniciar animación
        animationId = requestAnimationFrame(step);

        // 3. Control de Pausa e Interacción
        carousel.addEventListener("mouseenter", () => (isHovered = true));
        carousel.addEventListener("mouseleave", () => (isHovered = false));

        // Soporte básico para arrastrar (Drag to scroll)
        let isDown = false;
        let startX: number;
        let startScrollLeft: number;

        carousel.addEventListener("mousedown", (e) => {
            isDown = true;
            isHovered = true; // Pausar autoscroll mientras arrastra
            carousel.style.cursor = "grabbing";
            startX = e.pageX - carousel.offsetLeft;
            startScrollLeft = scrollAmount; // Usamos nuestra variable tracker
        });

        carousel.addEventListener("mouseleave", () => {
            isDown = false;
            isHovered = false;
            carousel.style.cursor = "grab";
        });

        carousel.addEventListener("mouseup", () => {
            isDown = false;
            // No seteamos isHovered = false aquí inmediatamente para evitar saltos bruscos si el mouse sigue encima
            carousel.style.cursor = "grab";
        });

        carousel.addEventListener("mousemove", (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - carousel.offsetLeft;
            const walk = (x - startX) * 2; // Velocidad del drag
            scrollAmount = startScrollLeft - walk;
            // Manejar límites en el drag manual para que no se rompa la ilusión infinita
            if (scrollAmount < 0) scrollAmount = 0;
            carousel.scrollLeft = scrollAmount;
        });
    }

    // Inicializar cuando el DOM esté listo
    if (typeof window !== "undefined") {
        document.addEventListener("DOMContentLoaded", initInfiniteCarousel);
    }
</script>

<style>
    /* Utilidad para ocultar scrollbar */
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* Opcional: Desvanecimiento en los bordes para mejorar el efecto infinito */
    /* .mask-gradient {
        mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    } */
</style>
