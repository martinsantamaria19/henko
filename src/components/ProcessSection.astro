---
import innovacionIcon from "../assets/innovacion-icon.webp";
import impactoIcon from "../assets/impacto-icon.webp";
import trascendenciaIcon from "../assets/trascendencia-icon.webp";
import evolucionIcon from "../assets/evolucion-icon.webp";
import propositoIcon from "../assets/proposito-icon.webp";
import pertinenciaIcon from "../assets/pertinencia-icon.webp";

const services = [
    {
        id: "innovacion",
        icon: innovacionIcon,
        title: "Innovación",
        shortDesc: "It is a long established fact that a reader will be distracted.",
        rightTitle: "Innovación Constante",
        rightDesc: [
            "En un mercado saturado, la innovación no es una opción, es una supervivencia. Transformamos ideas convencionales en experiencias digitales disruptivas.",
            "Utilizamos las últimas tecnologías para asegurar que tu marca siempre esté un paso adelante."
        ],
        marginClass: "ml-0" 
    },
    {
        id: "impacto",
        icon: impactoIcon,
        title: "Impacto",
        shortDesc: "Creating measurable impact in every interaction.",
        rightTitle: "Impacto Medible",
        rightDesc: [
            "No solo creamos cosas bonitas; creamos soluciones que mueven la aguja. Cada píxel y cada línea de código está pensada para generar conversión.",
            "Nos enfocamos en KPIs reales que hacen crecer tu negocio."
        ],
        marginClass: "ml-5" 
    },
    {
        id: "trascendencia",
        icon: trascendenciaIcon,
        title: "Trascendencia",
        shortDesc: "Going beyond the ordinary to leave a mark.",
        rightTitle: "Trascendencia de Marca",
        rightDesc: [
            "Construimos legados digitales. Tu marca no debe ser solo vista, debe ser recordada.",
            "Desarrollamos estrategias a largo plazo que aseguran la relevancia de tu empresa en el futuro."
        ],
        marginClass: "ml-10" 
    },
    {
        id: "evolucion",
        icon: evolucionIcon,
        title: "Evolución",
        shortDesc: "Adapting and growing with the digital landscape.",
        rightTitle: "Evolución Continua",
        rightDesc: [
            "El mundo digital cambia rápido. Nosotros te ayudamos a evolucionar con él, iterando y mejorando constantemente tus productos.",
            "La adaptabilidad es la clave del éxito en la era moderna."
        ],
        marginClass: "ml-10" 
    },
    {
        id: "proposito",
        icon: propositoIcon,
        title: "Propósito",
        shortDesc: "Driven by a clear and meaningful purpose.",
        rightTitle: "Propósito Definido",
        rightDesc: [
            "Trabajamos con marcas que tienen un porqué. Alineamos tu estrategia digital con los valores fundamentales de tu organización.",
            "Conectamos emocionalmente con tu audiencia a través de historias auténticas."
        ],
        marginClass: "ml-5" 
    },
    {
        id: "pertinencia",
        icon: pertinenciaIcon,
        title: "Pertinencia",
        shortDesc: "Staying relevant in a fast-paced world.",
        rightTitle: "Pertinencia Cultural",
        rightDesc: [
            "Entendemos el contexto cultural y social para crear mensajes que resuenen aquí y ahora.",
            "Hacemos que tu marca forme parte de la conversación actual."
        ],
        marginClass: "ml-0" 
    },
];

// Estilos
const cardStyles = "flex-1 bg-white rounded-tl-[20px] rounded-tr-[50px] rounded-br-[15px] rounded-bl-[80px] shadow-[0_10px_30px_-15px_rgba(0,0,0,0.1)] p-6 pl-10 border-b-2 border-gray-50 relative top-4";
const iconWrapperStyles = "flex-shrink-0 relative z-10 -mr-8 drop-shadow-xl hover:scale-110 transition-transform duration-300";
const iconImageStyles = "w-20 h-20 object-contain";
const itemWrapperStyles = "flex items-start group js-left-card opacity-0 translate-y-12 will-change-transform";
---

<section class="py-20 relative overflow-hidden js-pin-section">
    <div class="container mx-auto px-8 grid grid-cols-1 lg:grid-cols-2 gap-20 items-center h-full">
        
        <div class="relative pr-4">
            <svg 
                class="absolute top-0 left-[2.5rem] h-full w-auto -z-0 pointer-events-none opacity-80" 
                viewBox="0 0 60 900" 
                fill="none" 
                preserveAspectRatio="none"
            >
                <path 
                    d="M 2 50 C 20 200, 42 300, 42 400 L 42 500 C 42 600, 20 700, 2 850" 
                    stroke="#1e293b" 
                    stroke-width="4" 
                    stroke-linecap="round"
                />
            </svg>

            <div class="space-y-8 relative z-10 pb-20">
                {services.map((service) => (
                    <div class={`${itemWrapperStyles} ${service.marginClass}`}>
                        <div class={iconWrapperStyles}>
                            <img src={service.icon.src} alt={service.title} class={iconImageStyles} />
                        </div>
                        <div class={cardStyles}>
                            <h3 class="text-xl font-bold text-primary-dark italic">{service.title}</h3>
                            <p class="text-sm text-gray-500 mt-2 leading-relaxed">
                                {service.shortDesc}
                            </p>
                        </div>
                    </div>
                ))}
            </div>
        </div>

        <div class="lg:pl-12 relative h-[500px] flex items-center">
            {services.map((service, index) => (
                <div class="js-right-content absolute top-0 left-0 w-full opacity-0 translate-y-8 will-change-transform flex flex-col justify-center h-full pointer-events-none">
                    <h2 class="text-4xl font-bold text-primary-dark mb-6">
                        {service.rightTitle}
                    </h2>
                    <div class="space-y-6 text-gray-600 text-lg leading-relaxed">
                        {service.rightDesc.map(paragraph => (
                            <p>{paragraph}</p>
                        ))}
                    </div>

                    <a
                        href="#"
                        class="inline-flex w-fit items-center gap-2 bg-primary-light text-white px-8 py-4 rounded-full font-semibold mt-10 hover:bg-primary-dark transition-colors shadow-md pointer-events-auto"
                    >
                        MÁS SOBRE {service.title.toUpperCase()}
                        <span>→</span>
                    </a>

                    <div class="flex gap-3 mt-16 justify-end opacity-80">
                        <div class="w-10 h-10 rounded-full bg-primary-light opacity-50"></div>
                        <div class="w-10 h-10 rounded-full bg-primary-dark"></div>
                        <div class="w-10 h-10 rounded-full bg-primary-light"></div>
                    </div>
                </div>
            ))}
        </div>
    </div>
</section>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener("DOMContentLoaded", () => {
        const pinSection = document.querySelector(".js-pin-section");
        const leftCards = document.querySelectorAll(".js-left-card");
        const rightContents = document.querySelectorAll(".js-right-content");
        
        if (!pinSection || leftCards.length === 0 || rightContents.length === 0) return;

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: pinSection,
                start: "top top", 
                end: `+=${leftCards.length * 600}`, 
                pin: true, 
                scrub: 1, 
                anticipatePin: 1
            }
        });

        leftCards.forEach((leftCard, index) => {
            const rightContent = rightContents[index];
            const prevRightContent = index > 0 ? rightContents[index - 1] : null;

            if (prevRightContent) {
                tl.to(prevRightContent, {
                    autoAlpha: 0, 
                    y: -40,       
                    duration: 0.25, 
                    ease: "power2.in"
                });
            }

            tl.to(leftCard, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: "power2.out"
            }, index === 0 ? "" : ">-0.15"); 

            tl.to(rightContent, {
                autoAlpha: 1,
                y: 0, 
                duration: 0.8,
                ease: "power2.out"
            }, "<"); 
            
            tl.to({}, { duration: 0.4 }); 
        });
    });
</script>