---
import arquiBrokersRounded from "../assets/arqui-brokers-rounded-testimonials.webp";
import castellsInmueblesRound from "../assets/castells-rounded.webp";
import globalCargoRound from "../assets/global-cargo-rounded2.webp";
import acqualifeRound from "../assets/acqua-life-rounded.webp";
---

<section class="py-0 md:py-24 bg-[#EDF1F4] relative overflow-hidden" id="testimonials">
    <!-- Elementos decorativos sutiles en el fondo (misma sección en mobile, ajustados) -->
    <div class="absolute inset-0 z-0 pointer-events-none">
        <!-- Círculos pequeños: tamaños responsive para mobile -->
        <div
            class="absolute top-20 left-6 md:top-32 md:left-16 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-36 right-8 md:top-48 md:right-24 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute bottom-28 left-8 md:bottom-40 md:left-32 w-3 h-3 md:w-5 md:h-5 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute bottom-40 right-6 md:bottom-56 md:right-16 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-1/2 left-1/5 md:left-1/4 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-1/3 right-1/4 md:right-1/3 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-16 left-1/4 md:left-1/3 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-48 right-6 md:top-64 md:right-16 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute bottom-16 left-1/6 md:bottom-20 md:left-1/4 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute bottom-24 right-1/4 md:bottom-32 md:right-1/3 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-1/5 left-4 md:top-1/4 md:left-20 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-3/4 right-1/6 md:right-1/4 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute bottom-1/4 left-1/2 w-2 h-2 md:w-3 md:h-3 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>
        <div
            class="absolute top-[15%] right-[10%] md:top-1/5 md:right-1/5 w-2.5 h-2.5 md:w-4 md:h-4 rounded-full"
            style="background-color: #759EBC; opacity: 0.6;"
        >
        </div>

        <!-- Símbolos X: tamaños responsive -->
        <svg
            class="absolute top-28 right-4 md:top-40 md:right-12 w-4 h-4 md:w-6 md:h-6"
            fill="none"
            stroke="#759EBC"
            viewBox="0 0 24 24"
            style="opacity: 0.8;"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2.5"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        <svg
            class="absolute bottom-28 left-4 md:bottom-40 md:left-12 w-3.5 h-3.5 md:w-5 md:h-5"
            fill="none"
            stroke="#759EBC"
            viewBox="0 0 24 24"
            style="opacity: 0.8;"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2.5"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        <svg
            class="absolute top-40 right-1/4 md:top-60 md:right-40 w-3.5 h-3.5 md:w-5 md:h-5"
            fill="none"
            stroke="#759EBC"
            viewBox="0 0 24 24"
            style="opacity: 0.5;"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        <svg
            class="absolute bottom-16 left-1/4 md:bottom-20 md:left-1/3 w-3.5 h-3.5 md:w-5 md:h-5"
            fill="none"
            stroke="#759EBC"
            viewBox="0 0 24 24"
            style="opacity: 0.5;"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        <svg
            class="absolute bottom-24 right-4 md:bottom-32 md:right-16 w-3.5 h-3.5 md:w-5 md:h-5"
            fill="none"
            stroke="#759EBC"
            viewBox="0 0 24 24"
            style="opacity: 0.5;"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
        </svg>

        <!-- Símbolos +: tamaños responsive -->
        <div
            class="absolute top-16 left-6 md:top-24 md:left-24 text-2xl md:text-4xl font-light"
            style="color: #759EBC; opacity: 0.8;"
        >
            +
        </div>
        <div
            class="absolute bottom-24 right-8 md:bottom-32 md:right-28 text-2xl md:text-4xl font-light"
            style="color: #759EBC; opacity: 0.8;"
        >
            +
        </div>
        <div
            class="absolute top-1/2 right-4 md:right-20 text-xl md:text-3xl font-light"
            style="color: #759EBC; opacity: 0.8;"
        >
            +
        </div>
        <div
            class="absolute top-12 right-1/5 md:top-16 md:right-1/4 text-xl md:text-3xl font-light"
            style="color: #759EBC; opacity: 0.5;"
        >
            +
        </div>
        <div
            class="absolute bottom-20 left-1/6 md:bottom-24 md:left-1/4 text-xl md:text-3xl font-light"
            style="color: #759EBC; opacity: 0.5;"
        >
            +
        </div>
    </div>

    <div class="container mx-auto px-6 md:px-8 relative z-10">
        <div class="text-center max-w-3xl mx-auto mb-6 md:mb-16">
            <h2
                class="text-3xl md:text-5xl font-extrabold text-[#0F172A] mb-3 md:mb-4 tracking-tight"
            >
                Testimonios
            </h2>
            <p class="text-slate-500 text-lg md:text-xl leading-relaxed">
                Lo que dicen nuestros clientes
            </p>
        </div>
        <div class="text-center">
            <a
                href="#"
                class="inline-flex items-center gap-2 bg-primary-dark text-white px-8 py-4 rounded-full font-semibold mt-0 mb-3 md:mb-5 hover:bg-primary-light transition-colors shadow-md"
            >
                Trabajemos juntos
                <span>→</span>
            </a>
        </div>

        <!-- Carousel Container -->
        <div
            class="relative overflow-hidden w-full mt-4 md:mt-12"
            id="testimonials-container"
        >
            <!-- Controles de flechas -->
            <button
                id="prev-btn"
                class="absolute left-2 md:left-4 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-14 md:h-14 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
                aria-label="Testimonio anterior"
            >
                <svg
                    class="w-6 h-6 text-[#0F172A]"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 19l-7-7 7-7"
                    ></path>
                </svg>
            </button>

            <button
                id="next-btn"
                class="absolute right-2 md:right-4 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-14 md:h-14 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
                aria-label="Testimonio siguiente"
            >
                <svg
                    class="w-6 h-6 text-[#0F172A]"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                    ></path>
                </svg>
            </button>

            <div class="flex w-max" id="testimonials-track">
                <!-- Testimonio 1 -->
                <div class="flex-shrink-0 select-none testimonial-slide py-0 md:py-0" data-slide-width>
                    <div class="px-4 md:px-8 flex justify-center">
                        <div
                            class="bg-transparent rounded-[2.5rem] py-6 px-4 md:p-12 w-full max-w-4xl h-full flex flex-col md:flex-row items-center gap-6 md:gap-12"
                        >
                        <!-- Logo con forma asimétrica -->
                        <div class="shrink-0 relative w-32 h-32 md:w-56 md:h-56 mb-6 md:mb-0">
                            <svg class="w-full h-full" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <clipPath id="asymmetric-shape-1">
                                        <circle cx="80" cy="80" r="75" />
                                    </clipPath>
                                </defs>
                                <image
                                    href={arquiBrokersRounded.src}
                                    x="0"
                                    y="0"
                                    width="160"
                                    height="160"
                                    clip-path="url(#asymmetric-shape-1)"
                                    preserveAspectRatio="xMidYMid meet"
                                />
                            </svg>
                        </div>
                        <!-- Contenido del testimonio -->
                        <div class="flex-1 text-center md:text-left">
                            <div class="mb-3 md:mb-4">
                                <h3
                                    class="text-xl md:text-2xl font-bold text-[#0F172A] mb-1"
                                >
                                    Arq. Allison B.
                                </h3>
                                <p
                                    class="text-[#759EBC] font-semibold text-sm md:text-base tracking-wide"
                                >
                                    Socio Arquibrokers
                                </p>
                            </div>
                            <p
                                class="text-[#4A5568] text-sm md:text-lg leading-relaxed font-normal"
                            >
                                Henko nos demostró por qué está considerada
                                entre <b
                                    >las mejores agencias de marketing
                                    digital en Uruguay</b
                                >: resultados claros y acompañamiento
                                constante.
                            </p>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Testimonio 2 -->
                <div class="flex-shrink-0 select-none testimonial-slide py-0 md:py-0" data-slide-width>
                    <div class="px-4 md:px-8 flex justify-center">
                        <div
                            class="bg-transparent rounded-[2.5rem] py-6 px-4 md:p-12 w-full max-w-4xl h-full flex flex-col md:flex-row items-center gap-6 md:gap-12"
                        >
                        <!-- Logo con forma asimétrica -->
                        <div class="shrink-0 relative w-32 h-32 md:w-56 md:h-56 mb-6 md:mb-0">
                            <svg class="w-full h-full" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <clipPath id="asymmetric-shape-1">
                                        <circle cx="80" cy="80" r="75" />
                                    </clipPath>
                                </defs>
                                <image
                                    href={castellsInmueblesRound.src}
                                    x="0"
                                    y="0"
                                    width="160"
                                    height="160"
                                    clip-path="url(#asymmetric-shape-1)"
                                    preserveAspectRatio="xMidYMid meet"
                                />
                            </svg>
                        </div>
                        <!-- Contenido del testimonio -->
                        <div class="flex-1 text-center md:text-left">
                            <div class="mb-3 md:mb-4">
                                <h3
                                    class="text-xl md:text-2xl font-bold text-[#0F172A] mb-1"
                                >
                                    Andrés Z.
                                </h3>
                                <p
                                    class="text-[#759EBC] font-semibold text-sm md:text-base tracking-wide"
                                >
                                    Encargado de Marketing (Castells)
                                </p>
                            </div>
                            <p
                                class="text-[#4A5568] text-sm md:text-lg leading-relaxed font-normal"
                            >
                            Henko se convirtió en un verdadero <strong>socio estratégico</strong> para nuestro <strong>crecimiento digital</strong>. Más que una agencia de marketing digital, es un equipo que
                            trabaja con <strong>datos</strong>, optimiza <strong>campañas digitales</strong> de forma constante y logra <strong>resultados medibles y sostenidos.</strong>
                            </p>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Testimonio 3 -->
                <div class="flex-shrink-0 select-none testimonial-slide py-0 md:py-0" data-slide-width>
                    <div class="px-4 md:px-8 flex justify-center">
                        <div
                            class="bg-transparent rounded-[2.5rem] py-6 px-4 md:p-12 w-full max-w-4xl h-full flex flex-col md:flex-row items-center gap-6 md:gap-12"
                        >
                        <!-- Logo con forma asimétrica -->
                        <div class="shrink-0 relative w-32 h-32 md:w-56 md:h-56 mb-6 md:mb-0">
                            <svg class="w-full h-full" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <clipPath id="asymmetric-shape-1">
                                        <circle cx="80" cy="80" r="75" />
                                    </clipPath>
                                </defs>
                                <image
                                    href={acqualifeRound.src}
                                    x="0"
                                    y="0"
                                    width="160"
                                    height="160"
                                    clip-path="url(#asymmetric-shape-1)"
                                    preserveAspectRatio="xMidYMid meet"
                                />
                            </svg>
                        </div>
                        <!-- Contenido del testimonio -->
                        <div class="flex-1 text-center md:text-left">
                            <div class="mb-3 md:mb-4">
                                <h3
                                    class="text-xl md:text-2xl font-bold text-[#0F172A] mb-1"
                                >
                                    Marcelo B.
                                </h3>
                                <p
                                    class="text-[#759EBC] font-semibold text-sm md:text-base tracking-wide"
                                >
                                    Director (Acqualife)
                                </p>
                            </div>
                            <p
                                class="text-[#4A5568] text-sm md:text-lg leading-relaxed font-normal"
                            >
                            Valoramos el trabajo sostenido junto a Henko para fortalecer nuestra <strong>presencia digital</strong> a través de <strong>Google Ads, Meta Ads y otros medios digitales</strong>. Es una <strong>agencia de marketing digital enfocada en performance</strong>, con objetivos claros y capacidad de superar año a año nuestras <strong>metas de crecimiento y resultados</strong>.
                            </p>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Testimonio 4 -->
                <div class="flex-shrink-0 select-none testimonial-slide py-0 md:py-0" data-slide-width>
                    <div class="px-4 md:px-8 flex justify-center">
                        <div
                            class="bg-transparent rounded-[2.5rem] py-6 px-4 md:p-12 w-full max-w-4xl h-full flex flex-col md:flex-row items-center gap-6 md:gap-12"
                        >
                        <!-- Logo con forma asimétrica -->
                        <div class="shrink-0 relative w-32 h-32 md:w-56 md:h-56 mb-6 md:mb-0">
                            <svg class="w-full h-full" viewBox="0 0 160 160" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <clipPath id="asymmetric-shape-1">
                                        <circle cx="80" cy="80" r="75" />
                                    </clipPath>
                                </defs>
                                <image
                                    href={globalCargoRound.src}
                                    x="0"
                                    y="0"
                                    width="160"
                                    height="160"
                                    clip-path="url(#asymmetric-shape-1)"
                                    preserveAspectRatio="xMidYMid meet"
                                />
                            </svg>
                        </div>
                        <!-- Contenido del testimonio -->
                        <div class="flex-1 text-center md:text-left">
                            <div class="mb-3 md:mb-4">
                                <h3
                                    class="text-xl md:text-2xl font-bold text-[#0F172A] mb-1"
                                >
                                    Sergio A.
                                </h3>
                                <p
                                    class="text-[#759EBC] font-semibold text-sm md:text-base tracking-wide"
                                >
                                    CEO (Global Cargo)
                                </p>
                            </div>
                            <p
                                class="text-[#4A5568] text-sm md:text-lg leading-relaxed font-normal"
                            >
                            Trabajar con Henko es contar con un verdadero <strong>partner estratégico en marketing digital</strong>. Su enfoque en <strong>campañas digitales</strong>, el análisis de <strong>datos</strong> y la optimización constante nos permitió lograr <strong>resultados sólidos y medibles</strong>, siempre con un trato cercano y profesional.
                            </p>
                        </div>
                    </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Progress Bar con indicador circular (solo desktop) -->
        <div class="hidden md:flex flex-col items-center gap-2 mt-10">
            <div
                class="relative w-full max-w-xs h-1 bg-[#D1D5DB] rounded-full overflow-visible"
            >
                <div
                    id="progress-bar"
                    class="h-full bg-[#4A5568] rounded-full transition-all duration-500 ease-out"
                    style="width: 33.33%;"
                >
                </div>
                <div
                    id="progress-indicator"
                    class="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-[#759EBC] rounded-full transition-all duration-500 ease-out shadow-md"
                    style="left: calc(33.33% - 6px);"
                >
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    import { gsap } from "gsap";

    document.addEventListener("DOMContentLoaded", () => {
        const track = document.getElementById("testimonials-track");
        const container = document.getElementById("testimonials-container");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const progressBar = document.getElementById("progress-bar");
        const progressIndicator = document.getElementById("progress-indicator");

        if (!track || !container || !prevBtn || !nextBtn) return;

        const slides = track.querySelectorAll(".testimonial-slide");
        const originalCount = slides.length;
        const totalSlides = originalCount;

        // Clonar primero y último para carrusel infinito suave
        const firstClone = slides[0].cloneNode(true) as HTMLElement;
        const lastClone = slides[originalCount - 1].cloneNode(true) as HTMLElement;
        track.appendChild(firstClone);
        track.insertBefore(lastClone, slides[0]);

        const allSlides = track.querySelectorAll(".testimonial-slide");

        // Índice actual en el array con clones (1 = primer slide real)
        let currentIndex = 1;

        // Establecer el ancho de cada slide igual al contenedor
        const setSlideWidths = () => {
            const containerWidth = container.offsetWidth;
            allSlides.forEach((slide) => {
                (slide as HTMLElement).style.width = `${containerWidth}px`;
            });
        };

        const updateProgress = () => {
            // Índice lógico (0..totalSlides-1) ignorando clones
            let logicalIndex = currentIndex - 1;
            if (currentIndex === 0) logicalIndex = totalSlides - 1;
            if (currentIndex === totalSlides + 1) logicalIndex = 0;

            const progress = ((logicalIndex + 1) / totalSlides) * 100;
            if (progressBar) {
                progressBar.style.width = `${progress}%`;
            }
            if (progressIndicator) {
                progressIndicator.style.left = `calc(${progress}% - 6px)`;
            }
        };

        const goToIndex = (targetIndex: number) => {
            const containerWidth = container.offsetWidth;

            // Cancelar animaciones anteriores para evitar saltos
            gsap.killTweensOf(track);

            gsap.to(track, {
                x: -(targetIndex * containerWidth),
                duration: 0.35,
                ease: "power2.inOut",
                overwrite: "auto",
                force3D: true,
                onComplete: () => {
                    // Si estamos en el clon anterior al primero real, saltar al último real
                    if (targetIndex === 0) {
                        currentIndex = totalSlides;
                        gsap.set(track, { x: -(currentIndex * containerWidth) });
                    }
                    // Si estamos en el clon posterior al último real, saltar al primero real
                    else if (targetIndex === totalSlides + 1) {
                        currentIndex = 1;
                        gsap.set(track, { x: -(currentIndex * containerWidth) });
                    } else {
                        currentIndex = targetIndex;
                    }
                    updateProgress();
                },
            });
        };

        if (prevBtn) {
            prevBtn.addEventListener("click", () => {
                goToIndex(currentIndex - 1);
            });
        }

        if (nextBtn) {
            nextBtn.addEventListener("click", () => {
                goToIndex(currentIndex + 1);
            });
        }

        // Inicializar
        setSlideWidths();
        // Posicionar en el primer slide real
        gsap.set(track, { x: -(currentIndex * container.offsetWidth) });
        updateProgress();

        // Manejar redimensionamiento
        let resizeTimeout: NodeJS.Timeout;
        window.addEventListener("resize", () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                setSlideWidths();
                gsap.set(track, { x: -(currentIndex * container.offsetWidth) });
                updateProgress();
            }, 250);
        });
    });
</script>

<style>
    #testimonials-track {
        will-change: transform;
    }
</style>
